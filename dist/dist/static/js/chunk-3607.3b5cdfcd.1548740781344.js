(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-3607"],{"7rPQ":function(e,t,r){"use strict";var a=r("e0V3");r.n(a).a},e0V3:function(e,t,r){},jMyb:function(e,t,r){"use strict";r.r(t);var a,n=r("14Xm"),s=r.n(n),o=r("D3Ub"),i=r.n(o),l=r("7Qib"),c={data:function(){return{formInline:{roleName:""},tableData:[],isAdminRole:!1,isUpdate:!1,showSuperRole:!1,multipleSelection:[],page:{pageSize:50,total:0,currentPage:1},switchForm:!1,delTip:!1,role:{},panelTitle:"",setting:{data:{simpleData:{enable:!0,idKey:"menuId",pIdKey:"parentId",rootPId:-1},key:{url:"nourl"}},check:{enable:!0,nocheckInherit:!0}},orgTree:[]}},created:function(){this.getRoleList(),this.getOrgTree()},methods:{hasPermission:function(e){return Object(l.f)(e)},query:function(){var e=this;return i()(s.a.mark(function t(){var r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._fetch("/sys/role/list?limit=50&page=1&roleName="+e.formInline.roleName,{method:"GET"});case 2:r=t.sent,e.tableData=r.page.list;case 4:case"end":return t.stop()}},t,e)}))()},clearHandle:function(){this.formInline.roleName=""},add:function(){this.isUpdate=!1,"true"===this._adminEd&&(this.showSuperRole=!0),this.role={},this.switchForm=!0,this.panelTitle="新增角色",this.initOrgTree()},selectRoleType:function(e){this.isAdminRole=e?0:1},update:function(e,t){this.isUpdate=!0,"true"===this._adminEd&&(this.showSuperRole=!0),this.switchForm=!0,this.panelTitle="角色信息更改",this.initOrgTree(t.roleId)},del:function(){this.multipleSelection.length<1?this.$message("请选择一条记录"):this.delTip=!0},handleSelectionChange:function(e){var t=this;this.multipleSelection=e,this.role.roleIds=[],this.multipleSelection.forEach(function(e){t.role.roleIds.push(e.roleId)}),this.rowData=this.multipleSelection[0],this.rowData&&(this.role.roleId=this.rowData.roleId)},getRowData:function(e){this.$refs.dataTable.toggleRowSelection(e),this.rowData=e,this.role.roleId=this.rowData.roleId},onSubmit:function(){if(Object(l.g)(this.role.roleName))return this.$message("角色名不能为空"),!0;for(var e=a.getCheckedNodes(!0),t=new Array,r=0;r<e.length;r++)t.push(e[r].menuId);this.role.menuIdList=t,this.role.roleType=this.isAdminRole?0:1;var n=null==this.role.roleId?"/sys/role/save":"/sys/role/update";this.addUser(n)},addUser:function(e){var t=this;return i()(s.a.mark(function r(){var a;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t._fetch(e,{method:"POST",body:t.role});case 2:0===(a=r.sent).code?(t.$message("操作成功"),t.getRoleList(),t.switchForm=!1):t.$message(a.msg);case 4:case"end":return r.stop()}},r,t)}))()},delConfirm:function(){var e=this;return i()(s.a.mark(function t(){var r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._fetch("/sys/role/delete",{method:"POST",body:e.role.roleIds});case 2:0===(r=t.sent).code?(e.$message("操作成功"),e.getRoleList(),e.delTip=!1):e.$message(r.msg);case 4:case"end":return t.stop()}},t,e)}))()},reback:function(){this.switchForm=!1},getOrgTree:function(){var e=this;return i()(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._fetch("/sys/menu/roleMenu?_=123",{method:"GET"});case 2:e.orgTree=t.sent;case 3:case"end":return t.stop()}},t,e)}))()},initOrgTree:function(e){(a=$.fn.zTree.init($("#menuTree"),this.setting,this.orgTree)).expandAll(!1),null!=e&&this.getRole(e)},getRole:function(e){var t=this;return i()(s.a.mark(function r(){var n,o,i,l;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t._fetch("/sys/role/info/"+e,{method:"GET"});case 2:for(n=r.sent,t.role=n.role,t.isAdminRole=0==n.role.roleType,o=t.role.menuIdList,i=0;i<o.length;i++)l=a.getNodeByParam("menuId",o[i]),a.checkNode(l,!0);case 7:case"end":return r.stop()}},r,t)}))()},setOrg:function(e,t,r,a){this.user.orgName=r.orgName,this.user.orgId=r.orgId,this.showDealers=!1,this.showOrgList=!this.showOrgList},getRoleList:function(){var e=this;return i()(s.a.mark(function t(){var r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._fetch("/sys/role/list?limit=50&page=1",{method:"GET"});case 2:r=t.sent,e.tableData=r.page.list,e.page.total=r.page.totalCount,e.page.pageSize=r.page.pageSize;case 6:case"end":return t.stop()}},t,e)}))()},handleSizeChange:function(e){var t=this;return i()(s.a.mark(function r(){var a;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t._fetch("/sys/role/list?limit="+e+"&page="+t.page.currentPage,{method:"GET"});case 2:a=r.sent,t.tableData=a.page.list,t.page.pageSize=e;case 5:case"end":return r.stop()}},r,t)}))()},handleCurrentChange:function(e){var t=this;return i()(s.a.mark(function r(){var a;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t._fetch("/sys/role/list?limit="+t.page.pageSize+"&page="+e,{method:"GET"});case 2:a=r.sent,t.tableData=a.page.list,t.page.currentPage=e;case 5:case"end":return r.stop()}},r,t)}))()},rowClass:function(){return"text-align:center"}}},u=(r("7rPQ"),r("KHd+")),h=Object(u.a)(c,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"page-container"},[r("div",{directives:[{name:"show",rawName:"v-show",value:!e.switchForm,expression:"!switchForm"}],staticClass:"show-box"},[r("div",{staticClass:"query-box"},[r("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline}},[r("el-form-item",{staticClass:"form-item",attrs:{label:""}},[r("el-input",{attrs:{placeholder:"请输入角色名称"},model:{value:e.formInline.roleName,callback:function(t){e.$set(e.formInline,"roleName","string"==typeof t?t.trim():t)},expression:"formInline.roleName"}})],1),e._v(" "),r("el-form-item",{staticClass:"form-item"},[r("el-button",{attrs:{type:"info"},on:{click:e.query}},[e._v("查询")]),e._v(" "),r("el-button",{attrs:{type:"info"},on:{click:e.clearHandle}},[e._v("清空")])],1)],1)],1),e._v(" "),r("div",{staticClass:"btn-box"},[e.hasPermission("sys:role:save")?r("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.add}},[e._v("新增")]):e._e(),e._v(" "),e.hasPermission("sys:role:delete")?r("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:e.del}},[e._v("删除")]):e._e()],1),e._v(" "),r("el-dialog",{attrs:{title:"提示",visible:e.delTip,width:"20%",top:"30vh"},on:{"update:visible":function(t){e.delTip=t}}},[r("span",[e._v("确定要删除选中的记录？")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.delTip=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.delConfirm}},[e._v("确 定")])],1)]),e._v(" "),r("div",{staticClass:"tb-box"},[r("el-table",{ref:"dataTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,"header-cell-style":e.rowClass,border:"","max-height":"700"},on:{"selection-change":e.handleSelectionChange,"row-click":e.getRowData}},[r("el-table-column",{attrs:{type:"index",width:"40",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{type:"selection",width:"45",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{prop:"roleId",label:"角色ID",align:"left",width:"200"}}),e._v(" "),r("el-table-column",{attrs:{prop:"roleName",label:"角色名称",align:"left",width:"300"}}),e._v(" "),r("el-table-column",{attrs:{prop:"remark",label:"备注",align:"left"}}),e._v(" "),r("el-table-column",{attrs:{prop:"createTime",label:"创建时间",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{prop:"",label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.hasPermission("sys:role:update")?r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(r){e.update(t.$index,t.row)}}},[e._v("修改")]):e._e()]}}])})],1)],1),e._v(" "),r("div",{staticClass:"block"},[r("el-pagination",{attrs:{"current-page":e.page.currentPage,"page-sizes":[10,30,50],"page-size":e.page.pageSize,total:e.page.total,layout:"total, sizes, prev, pager, next, jumper",background:""},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.switchForm,expression:"switchForm"}],staticClass:"form-section"},[r("div",{staticClass:"panel",domProps:{innerHTML:e._s(e.panelTitle)}}),e._v(" "),r("div",{staticClass:"form-container"},[r("el-form",{ref:"role",attrs:{model:e.role,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"角色名称"}},[r("el-input",{attrs:{placeholder:"角色名称"},model:{value:e.role.roleName,callback:function(t){e.$set(e.role,"roleName",t)},expression:"role.roleName"}})],1),e._v(" "),e.showSuperRole?r("el-form-item",{attrs:{label:"超管角色"}},[r("el-checkbox-group",{on:{change:e.selectRoleType},model:{value:e.role.roleType,callback:function(t){e.$set(e.role,"roleType",t)},expression:"role.roleType"}},[r("el-checkbox",{attrs:{label:"",name:"type",disabled:e.isUpdate}})],1)],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"备注"}},[r("el-input",{attrs:{placeholder:"备注"},model:{value:e.role.remark,callback:function(t){e.$set(e.role,"remark",t)},expression:"role.remark"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"授权"}},[r("ul",{staticClass:"ztree",attrs:{id:"menuTree"}})]),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确定")]),e._v(" "),r("el-button",{attrs:{type:"warning"},on:{click:e.reback}},[e._v("返回")])],1)],1)],1)])])},[],!1,null,"74d3dfce",null);h.options.__file="index.vue";t.default=h.exports}}]);