(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-5aa2"],{PHGb:function(e,t,s){},VHDA:function(e,t,s){"use strict";var r=s("PHGb");s.n(r).a},zOwM:function(e,t,s){"use strict";s.r(t);var r=s("14Xm"),a=s.n(r),i=s("D3Ub"),n=s.n(i),o=s("7Qib"),l={data:function(){return{formInline:{user:"",region:""},tableData:[],rowData:{},multipleSelection:[],page:{pageSize:50,total:0,currentPage:1},tflag:!1,switchForm:!1,showDealers:!0,showOrgSelect:!0,showOrgList:!1,showSuperUser:!1,active:!1,user:{},panelTitle:"",dealers:[],roleList:[],checkAbleRoleList:[],setting:{data:{simpleData:{enable:!0,idKey:"orgId",pIdKey:"parentId"},key:{url:"nourl",name:"orgName"}},callback:{onClick:this.setOrg}},orgTree:[],dialogFormVisible:!1,formLabelWidth:"60px",showTraPwd:!1,dialogVisible:!1,delTip:!1,isAdmin:!1}},created:function(){this.getAdminList(),this.getOrgTree(),this.getRoleList()},filters:{statusFilter:function(e){return{1:"success",2:"danger"}[e]},formatStata:function(e){return{1:"正常",2:"错误"}[e]}},methods:{hasPermission:function(e){return Object(o.f)(e)},query:function(){var e=this;return n()(a.a.mark(function t(){var s;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._fetch("/sys/user/list?limit=50&page=1&username="+e.formInline.user,{method:"GET"});case 2:s=t.sent,e.tableData=s.page.list;case 4:case"end":return t.stop()}},t,e)}))()},clearHandle:function(){this.formInline.user=""},add:function(){this.switchForm=!0,this.panelTitle="新增用户",this.isAdmin=!1,this.active=!1,this.user={status:"1",roleIdList:[],traPwd:""},this.getDealerList(),this.initOrgTree()},update:function(e,t){this.switchForm=!0,this.active=!0,this.panelTitle="用户信息更改","true"===this._adminEd?this.showSuperUser=!0:this.showSuperUser=!1,this.getUser(t.userId)},del:function(){this.multipleSelection.length<1?this.$message("请选择一条记录"):this.delTip=!0},uptDraPwd:function(){this.dialogFormVisible=!0,Object(o.g)(this.rowData.traPwd)?this.tflag=!1:this.tflag=!0,this.user.traPwd="",this.user.newTraPwd=""},reset:function(){this.dialogVisible=!0},onSubmit:function(){if(!this.validator()){this.user.adminEd=this.isAdmin;var e=null==this.user.userId?"/sys/user/save":"/sys/user/update";this.addUser(e)}},addUser:function(e){var t=this;return n()(a.a.mark(function s(){var r;return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,t._fetch(e,{method:"POST",body:t.user});case 2:0===(r=s.sent).code?(t.$message("操作成功"),t.getAdminList(),t.switchForm=!1):t.$message(r.msg);case 4:case"end":return s.stop()}},s,t)}))()},reback:function(){this.switchForm=!1},showOrg:function(){this.showOrgSelect=!1},cancelDealers:function(){this.showOrgSelect=!0,this.user.dealerId=""},showOrgTree:function(){this.showDealers=!1,this.showOrgList=!0},cancelOrg:function(){this.showDealers=!0,this.showOrgList=!1,this.user.orgId="",this.user.orgName=""},getOrgTree:function(){var e=this;return n()(a.a.mark(function t(){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._fetch("/org/bmorganization/list?_=123",{method:"GET"});case 2:e.orgTree=t.sent;case 3:case"end":return t.stop()}},t,e)}))()},initOrgTree:function(){$.fn.zTree.init($("#menuTree"),this.setting,this.orgTree).expandAll(!1)},setOrg:function(e,t,s,r){this.user.orgName=s.orgName,this.user.orgId=s.orgId,this.showDealers=!1,this.showOrgList=!this.showOrgList},getOrgSelected:function(){var e=this;void 0!==this.user.orgId&&this.orgTree.forEach(function(t){e.user.orgId+""===t.orgId&&(e.user.orgName=t.orgName)})},getAdminList:function(){var e=this;return n()(a.a.mark(function t(){var s;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._fetch("/sys/user/list?limit=50&page=1",{method:"GET"});case 2:0===(s=t.sent).code?(e.tableData=s.page.list,e.page.total=s.page.totalCount,e.page.pageSize=s.page.pageSize):e.$message(s.msg);case 4:case"end":return t.stop()}},t,e)}))()},getRowData:function(e){this.$refs.dataTable.toggleRowSelection(e),this.rowData=e,this.user.userId=this.rowData.userId},handleSelectionChange:function(e){var t=this;this.multipleSelection=e,this.user.userIds=[],this.multipleSelection.forEach(function(e){t.user.userIds.push(e.userId)}),this.rowData=this.multipleSelection[0],this.rowData&&(this.user.userId=this.rowData.userId)},setTraPwd:function(){var e=this;return n()(a.a.mark(function t(){var s;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.tflag){t.next=9;break}if(!Object(o.g)(e.user.traPwd)){t.next=4;break}return e.$message("原密码不能为空"),t.abrupt("return");case 4:if(!Object(o.g)(e.user.newTraPwd)){t.next=7;break}return e.$message("新密码不能为空"),t.abrupt("return");case 7:t.next=12;break;case 9:if(!Object(o.g)(e.user.newTraPwd)){t.next=12;break}return e.$message("密码不能为空"),t.abrupt("return");case 12:if(e.user.newTraPwd.length>5&&e.user.newTraPwd.length<21){t.next=15;break}return e.$message("请输入6-20位密码"),t.abrupt("return");case 15:return t.next=17,e._fetch("/sys/user/addOrUpdatePwd",{method:"POST",body:e.user});case 17:0===(s=t.sent).code?(e.$message("操作成功"),e.dialogFormVisible=!1):e.$message(s.msg);case 19:case"end":return t.stop()}},t,e)}))()},resetTraPwd:function(){var e=this;return n()(a.a.mark(function t(){var s;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.user={},e.user.userId=e.rowData.userId,e.user.traPwd=" ",t.next=5,e._fetch("/sys/user/reset",{method:"POST",body:e.user});case 5:0===(s=t.sent).code?(e.$message("操作成功"),e.dialogVisible=!1):e.$message(s.msg);case 7:case"end":return t.stop()}},t,e)}))()},delConfirm:function(){var e=this;return n()(a.a.mark(function t(){var s;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._fetch("/sys/user/delete",{method:"POST",body:e.user.userIds});case 2:0===(s=t.sent).code?(e.$message("操作成功"),e.getAdminList(),e.delTip=!1):e.$message(s.msg);case 4:case"end":return t.stop()}},t,e)}))()},getUser:function(e){var t=this;return n()(a.a.mark(function s(){var r;return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,t._fetch("/sys/user/info/"+e+"?_=123",{method:"GET"});case 2:(r=s.sent)&&(t.user=r.user,t.user.status=r.user.status.toString(),t.user.password=null,t.user.traPwd=null,t.isAdmin=0==t.user.userType,t.initOrgTree(),t.getDealerList(t.user.dealerId),t.getOrgSelected(),t.selectRoleList());case 4:case"end":return s.stop()}},s,t)}))()},getRoleList:function(){var e=this;return n()(a.a.mark(function t(){var s;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._fetch("/sys/role/select",{method:"GET"});case 2:s=t.sent,e.roleList=s.list,e.selectRoleList();case 5:case"end":return t.stop()}},t,e)}))()},selectRoleList:function(e){this.checkAbleRoleList=new Array;for(var t=0;t<this.roleList.length;t++)this.checkAbleRoleList.push(this.roleList[t])},changeType:function(e){console.log(e)},getDealerList:function(e){var t=this;return n()(a.a.mark(function s(){var r;return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,t._fetch("/org/dealer/ids",{method:"POST"});case 2:(r=s.sent)&&(t.dealers=r.dealers,t.user.dealerId&&(t.user.dealerId=e.toString()));case 4:case"end":return s.stop()}},s,t)}))()},handleSizeChange:function(e){var t=this;return n()(a.a.mark(function s(){var r;return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,t._fetch("/sys/user/list?limit="+e+"&page="+t.page.currentPage,{method:"GET"});case 2:r=s.sent,t.tableData=r.page.list,t.page.pageSize=e;case 5:case"end":return s.stop()}},s,t)}))()},handleCurrentChange:function(e){var t=this;return n()(a.a.mark(function s(){var r;return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,t._fetch("/sys/user/list?limit="+t.page.pageSize+"&page="+e,{method:"GET"});case 2:r=s.sent,t.tableData=r.page.list,t.page.currentPage=e;case 5:case"end":return s.stop()}},s,t)}))()},validator:function(){if(Object(o.g)(this.user.username))return this.$message("用户名不能为空"),!0;if(null==this.user.userId&&Object(o.g)(this.user.password))return this.$message("密码不能为空"),!0;return Object(o.g)(this.user.email)||/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/.test(this.user.email)?Object(o.g)(this.user.mobile)||/^1[34578]\d{9}$/.test(this.user.mobile)?void 0:(this.$message("手机号格式不正确"),!0):(this.$message("邮箱格式不正确"),!0)},rowClass:function(){return"text-align:center"}}},u=(s("VHDA"),s("KHd+")),c=Object(u.a)(l,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"page-container"},[s("div",{directives:[{name:"show",rawName:"v-show",value:!e.switchForm,expression:"!switchForm"}],staticClass:"show-box"},[s("div",{staticClass:"query-box"},[s("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline}},[s("el-form-item",{staticClass:"form-item",attrs:{label:""}},[s("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.formInline.user,callback:function(t){e.$set(e.formInline,"user","string"==typeof t?t.trim():t)},expression:"formInline.user"}})],1),e._v(" "),s("el-form-item",{staticClass:"form-item"},[s("el-button",{attrs:{type:"info"},on:{click:e.query}},[e._v("查询")]),e._v(" "),s("el-button",{attrs:{type:"info"},on:{click:e.clearHandle}},[e._v("清空")])],1)],1)],1),e._v(" "),s("div",{staticClass:"btn-box"},[e.hasPermission("sys:user:save")?s("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.add}},[e._v("新增")]):e._e(),e._v(" "),e.hasPermission("sys:user:delete")?s("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:e.del}},[e._v("删除")]):e._e()],1),e._v(" "),s("el-dialog",{attrs:{title:"密码设置",visible:e.dialogFormVisible,width:"20%",top:"30vh",center:""},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[s("el-form",{staticClass:"alertbox",attrs:{model:e.user}},[e.tflag?s("el-form-item",{attrs:{label:"原密码","label-width":e.formLabelWidth}},[s("el-input",{model:{value:e.user.traPwd,callback:function(t){e.$set(e.user,"traPwd",t)},expression:"user.traPwd"}})],1):e._e(),e._v(" "),s("el-form-item",{attrs:{label:"新密码","label-width":e.formLabelWidth}},[s("el-input",{model:{value:e.user.newTraPwd,callback:function(t){e.$set(e.user,"newTraPwd",t)},expression:"user.newTraPwd"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.setTraPwd}},[e._v("确 定")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"提示",visible:e.dialogVisible,width:"20%",top:"30vh"},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("span",[e._v("确定重置审批密码吗？")]),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.resetTraPwd}},[e._v("确 定")])],1)]),e._v(" "),s("el-dialog",{attrs:{title:"提示",visible:e.delTip,width:"20%",top:"30vh"},on:{"update:visible":function(t){e.delTip=t}}},[s("span",[e._v("确定要删除选中的记录？")]),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.delTip=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.delConfirm}},[e._v("确 定")])],1)]),e._v(" "),s("div",{staticClass:"tb-box"},[s("el-table",{ref:"dataTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,"header-cell-style":e.rowClass,border:"","max-height":"600"},on:{"row-click":e.getRowData,"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{type:"index",width:"40",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{type:"selection",width:"45",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"userId",label:"用户ID",width:"120",align:"left"}}),e._v(" "),s("el-table-column",{attrs:{prop:"username",label:"用户名",align:"left"}}),e._v(" "),s("el-table-column",{attrs:{prop:"email",label:"邮箱",align:"left"}}),e._v(" "),s("el-table-column",{attrs:{prop:"mobile",label:"手机号",align:"left"}}),e._v(" "),e._e(),e._v(" "),s("el-table-column",{attrs:{prop:"status",label:"状态",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tag",{attrs:{type:e._f("statusFilter")(t.row.status)}},[e._v(e._s(e._f("formatStata")(t.row.status)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"createTime",label:"创建时间",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"",label:"操作",align:"center",width:"400"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.hasPermission("sys:user:update")?s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(s){e.update(t.$index,t.row)}}},[e._v("修改")]):e._e(),e._v(" "),e.hasPermission("sys:user:addOrUpdatePwd")?s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(s){e.uptDraPwd(t.$index,t.row)}}},[e._v("审批密码设置")]):e._e(),e._v(" "),e.hasPermission("sys:user:resetPwd")?s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(s){e.reset(t.$index,t.row)}}},[e._v("审批密码重置")]):e._e()]}}])})],1)],1),e._v(" "),s("div",{staticClass:"block"},[s("el-pagination",{attrs:{"current-page":e.page.currentPage,"page-sizes":[10,30,50],"page-size":e.page.pageSize,total:e.page.total,layout:"total, sizes, prev, pager, next, jumper",background:""},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.switchForm,expression:"switchForm"}],staticClass:"form-section"},[s("div",{staticClass:"panel",domProps:{innerHTML:e._s(e.panelTitle)}}),e._v(" "),s("div",{staticClass:"form-container"},[s("el-form",{ref:"form",attrs:{model:e.user,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"用户名"}},[s("el-input",{attrs:{placeholder:"登录账号",name:"username",disabled:e.active},model:{value:e.user.username,callback:function(t){e.$set(e.user,"username",t)},expression:"user.username"}})],1),e._v(" "),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.active,expression:"!active"}],attrs:{label:"密码"}},[s("el-input",{attrs:{placeholder:"密码",name:"password"},model:{value:e.user.password,callback:function(t){e.$set(e.user,"password",t)},expression:"user.password"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"邮箱"}},[s("el-input",{attrs:{placeholder:"邮箱",name:"email"},model:{value:e.user.email,callback:function(t){e.$set(e.user,"email",t)},expression:"user.email"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"手机号"}},[s("el-input",{attrs:{placeholder:"手机号",name:"mobile"},model:{value:e.user.mobile,callback:function(t){e.$set(e.user,"mobile",t)},expression:"user.mobile"}})],1),e._v(" "),e.hasPermission("org:dealer:list")?s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.showDealers,expression:"showDealers"}],attrs:{label:"所属服务商"}},[s("el-select",{attrs:{placeholder:"请选择所属服务商"},on:{change:e.showOrg},model:{value:e.user.dealerId,callback:function(t){e.$set(e.user,"dealerId",t)},expression:"user.dealerId"}},e._l(e.dealers,function(e){return s("el-option",{key:e.dealerId,attrs:{label:e.dealerCode,value:e.dealerId}})})),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.cancelDealers}},[e._v("取消选择")])],1):e._e(),e._v(" "),e.hasPermission("org:bmorganization:list")?s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.showOrgSelect,expression:"showOrgSelect"}],attrs:{label:"所属机构"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.user.orgId,expression:"user.orgId"}],attrs:{type:"hidden"},domProps:{value:e.user.orgId},on:{input:function(t){t.target.composing||e.$set(e.user,"orgId",t.target.value)}}}),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.user.orgName,expression:"user.orgName"}],staticClass:"input",attrs:{placeholder:"请点击查询所属机构"},domProps:{value:e.user.orgName},on:{click:e.showOrgTree,input:function(t){t.target.composing||e.$set(e.user,"orgName",t.target.value)}}}),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.cancelOrg}},[e._v("取消选择")])],1):e._e(),e._v(" "),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.showOrgList,expression:"showOrgList"}],attrs:{label:"选择机构"}},[s("ul",{staticClass:"ztree",attrs:{id:"menuTree"}})]),e._v(" "),e.showSuperUser?s("el-form-item",{attrs:{label:"超管子账号"}},[s("el-checkbox-group",{on:{change:e.changeType},model:{value:e.user.userType,callback:function(t){e.$set(e.user,"userType",t)},expression:"user.userType"}},[s("el-checkbox",{attrs:{label:"",name:"type"}})],1)],1):e._e(),e._v(" "),s("el-form-item",{attrs:{label:"角色"}},[s("el-checkbox-group",{on:{change:e.selectRoleList},model:{value:e.user.roleIdList,callback:function(t){e.$set(e.user,"roleIdList",t)},expression:"user.roleIdList"}},e._l(e.checkAbleRoleList,function(t){return s("el-checkbox",{key:t.roleId,attrs:{label:t.roleId}},[e._v(e._s(t.roleName))])}))],1),e._v(" "),s("el-form-item",{attrs:{label:"状态"}},[s("el-radio-group",{model:{value:e.user.status,callback:function(t){e.$set(e.user,"status",t)},expression:"user.status"}},[s("el-radio",{attrs:{label:"0"}},[e._v("禁用")]),e._v(" "),s("el-radio",{attrs:{label:"1"}},[e._v("正常")])],1)],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确定")]),e._v(" "),s("el-button",{attrs:{type:"warning"},on:{click:e.reback}},[e._v("返回")])],1)],1)],1)])])},[],!1,null,"0f2cc14c",null);c.options.__file="index.vue";t.default=c.exports}}]);